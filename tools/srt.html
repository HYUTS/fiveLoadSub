<html>
<header>
    <title>SRT->FLS</title>
    <script>
        function zeroPad(num, places) {
            var zero = places - num.toString().length + 1;
            return Array(+(zero > 0 && zero)).join("0") + num;
        }

        function change() {
            var srtText = document.getElementById('text').value;
            var srtSearch = -1;
            var srtLines = [];
            var srtRegex = new RegExp(/[\d]+\n([0-9][0-9]\:[0-9][0-9]\:[0-9][0-9]\,[0-9]{3}\s\-\-\>\s[0-9][0-9]\:[0-9][0-9]\:[0-9][0-9]\,[0-9]{3})\n(.*)\n/);
            var result = [];
            var output = "";
            srtSearch = srtText.search(srtRegex);

            if (srtSearch > -1) {
                srtLines = srtText.split(/\n/);
                srtText = srtText.substring(srtSearch);
            }
            //console.log(srtLines);

            while ((srtLines.length >= 3) && (srtSearch > -1)) {
                var tmp = {
                    start: {
                        h: 0,
                        m: 0,
                        s: 0,
                        f: 0
                    },
                    end: {
                        h: 0,
                        m: 0,
                        s: 0,
                        f: 0
                    },
                    text: ""
                };

                tmp.start.h = parseInt(srtLines[1].substr(0, 2));
                tmp.start.m = parseInt(srtLines[1].substr(3, 2));
                tmp.start.s = parseInt(srtLines[1].substr(6, 2));
                tmp.start.f = parseInt(srtLines[1].substr(9, 3));

                tmp.end.h = parseInt(srtLines[1].substr(17, 2));
                tmp.end.m = parseInt(srtLines[1].substr(20, 2));
                tmp.end.s = parseInt(srtLines[1].substr(23, 2));
                tmp.end.f = parseInt(srtLines[1].substr(26, 3));
                tmp.text = srtLines[2];

                result.push(tmp);

                srtText = srtText.replace(srtRegex, "");
                //srtText = srtText.replace(/\n\n/, "\n");
                srtSearch = srtText.search(srtRegex);
                srtText = srtText.substring(srtSearch);
                srtLines = srtText.split(/\n/);

            }

            for (line of result) {
                output += '[' + zeroPad(line.start.h, 2) + ':' + zeroPad(line.start.m, 2) + ':' + zeroPad(line.start.s, 2) + '.' + zeroPad(Math.round(line.start.f / 1000 * 30), 2) + ']';
                output += line.text;
                output += '[' + zeroPad(line.end.h, 2) + ':' + zeroPad(line.end.m, 2) + ':' + zeroPad(line.end.s, 2) + '.' + zeroPad(Math.round(line.end.f / 1000 * 30), 2) + ']';
                output += '\n';
            }
            document.getElementById('output').value = output;

            /*tmp = tmp.replace(/\n\n/gi,'\n');
            tmp  = tmp.split(/\n|\s|\r/);
            var output = '';
            for (pieces of tmp) {
                output += pieces + '\n';
            }
             = output;
            */
            //document.getElementById('output').value = (tmp);
        }
    </script>
</header>

<body>
    <h1>SRT->FLS</h1>
    <table width="100%">
        <tr>
            <td style="width:50%">
                <textarea id="text" onchange="change();" style="width:100%" rows="30">></textarea>
            </td>
            <td style="width:50%">
                <textarea id="output" style="width:100%" rows="30"></textarea>

            </td>
        </tr>
    </table>
</body>

</html>
